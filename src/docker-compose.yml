version: '3.9'

services:
  db_evaluation:
    image: mysql:latest

  db_gamerepo:
    image: mysql:latest

  db_indentity:
    image: mcr.microsoft.com/mssql/server:2019-latest

  db_backmanage:
    image: mysql:latest

  mq_evaluation:
    image: rabbitmq:3.9.13-management

  cache_master:
    image: redis:latest

  gateway_web:
    image: envoyproxy/envoy-dev:35f8d59b1172a85f02dd119791a9ef42c728cfa8

  identity-api:
    image: ${REGISTRY:-eshop}/identity.api:${PLATFORM:-linux}-${TAG:-latest}
    build:
      context: .
      dockerfile: Services/IdentityServer/Identity.API/Dockerfile
    depends_on:
      - db_indentity
      - mq_evaluation

  evaluation-api:
    image: ${REGISTRY:-esite}/evaluation.api:${PLATFORM:-linux}-${TAG:-latest}
    build:
      context: .
      dockerfile: Services/Evaluation/Evaluation.API/Dockerfile
    depends_on:
      - db_evaluation
      - mq_evaluation
      - identity-api

  gamerepo-api:
    image: ${REGISTRY:-esite}/gamerepo.api:${PLATFORM:-linux}-${TAG:-latest}
    build:
      context: .
      dockerfile: Services/GameRepository/GameRepo.API/Dockerfile
    depends_on:
      - cache_master
      - db_gamerepo
      - mq_evaluation
      - identity-api

  ordering-api:
    image: ${REGISTRY:-esite}/ordering.api:${PLATFORM:-linux}-${TAG:-latest}
    build:
      context: .
      dockerfile: Services/Ordering/Ordering.API/Dockerfile
    depends_on:
      - cache_master
      - identity-api

  backmanage-api:
    image: ${REGISTRY:-esite}/backmanage.api:${PLATFORM:-linux}-${TAG:-latest}
    build:
      context: .
      dockerfile: Services/BackManager/BackManage.API/Dockerfile
    depends_on:
      - db_backmanage
      - identity-api

  webstatus:
    image: ${REGISTRY:-esite}/webstatus:${PLATFORM:-linux}-${TAG:-latest}
    build:
      context: .
      dockerfile: Web/WebStatus/Dockerfile
